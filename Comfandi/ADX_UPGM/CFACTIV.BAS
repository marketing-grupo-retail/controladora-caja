INTEGER*4  LEI%,  GRA%,   NEX%
CREATE POSFILE "C:\ACTIVI.DAT" AS 3 LOCAL
FINR$ = CHR$(13)+CHR$(10)
OPEN "C:\ACTIVI.DIR" DIRECT RECL 101 AS 1
!OPEN "EAMFBACT" KEYED RECL 101 AS 2
CLEARS
PRINT : PRINT : PRINT : PRINT 
PRINT " Convierte EAMFBACT en archivo plano para B. OBJETCT    "

IF END #1 THEN SALIR
ON ERROR GOTO RUTER
LEER:
LEI%  = LEI% + 1
READ FORM "C9 C4 C2 C4 C3 C3 C3 C24 C2 C4 C2 C4 C3 C4 C30";#1,  \
LEI%;KEY$,TOTPUN$,TOTTRAN$,REDI$,AUTOC$,UFECHA$,ULPUN$,NAPL$,FPERI$, \
PPERI$,TPERI$,PREDI$,NAPL1$,TVENTA$,REST$
EOF$ = "  "
IF EOF$ = "  " THEN BEGIN
TOTPUN$      = UNPACK$(TOTPUN$)
TOTTRAN$     = UNPACK$(TOTTRAN$)
REDI$        = UNPACK$(REDI$)
AUTOC$       = UNPACK$(AUTOC$)
UFECHA$      = UNPACK$(UFECHA$)
ULPUN$       = UNPACK$(ULPUN$)
FPERI$       = UNPACK$(FPERI$)
PPERI$       = UNPACK$(PPERI$)
TPERI$       = UNPACK$(TPERI$)
TVENTA$      = UNPACK$(TVENTA$)
CLIENTE$     = (UNPACK$(KEY$))
CLIENTE$     = RIGHT$(CLIENTE$,13)
PUNTOSP$     = PPERI$
IF VAL(PUNTOSP$) > 0 THEN BEGIN
 WRITE FORM "C13 C8 C4 C8 C6 C6 C4 C8 C4 C8 C2";#3;CLIENTE$,TOTPUN$,\
TOTTRAN$,REDI$,UFECHA$,ULPUN$,FPERI$,PUNTOSP$,TPERI$,TVENTA$,FINR$
GRA% = GRA%+1
ENDIF
ENDIF ELSE BEGIN
   NEX% = NEX% + 1
ENDIF
LOCATE 10,5  :  PRINT "    Le¡dos: ";LEI%
LOCATE 11,5  :  PRINT "  Grabados: ";GRA%
LOCATE 12,5  :  PRINT "No Existen: ";NEX%
LOCATE 13,5  :  PRINT "Cuenta No : ";unpack$(key$)
!LOCATE 14,5  :  PRINT "puntos per: ";unpack$(punp1$)

GOTO LEER

RUTER:
EOF$ = ERR
IF ERR = "EF" AND ERRF% = 2 THEN RESUME
PRINT "ERROR "; ERR;"  FILE ";ERRF%
SALIR:
close 1 : close 3
STOP
