!             PROGRAMA
!          
!----------------------------------------------------------
%ENVIRON C

String    Global MSG$, ERRFX$, PROFREE(1), TMP$, Dato.So$ 
STRING HOR$, HORA$, HORAPRO$, FECH$, ANO$, MES$, DIA$, FECHVEN1$, ANOVEN$
STRING MESVEN$, DIAVEN$, CONSUL$, CENCOS$, FECHVEN$, PROG$, RETOR$, RETORN1$
Integer   Global TS.ERROR, CTRL%, RETORNO%
Integer*2 Global  WI2%, EjegeNR
String    Global AA$, BB$, CC$, DD$, LLAVE$, ARCHIVOS$(2)

!%INCLUDE ADX_UPGM:BASROUT.J86

%INCLUDE ADX_UPGM:BASROUT.J86         ! Rutinas generales
!%INCLUDE ADX_UPGM:DMEXT     ! Inclucion Libreria Display Manager




ON ERROR GOTO ERRTN

HOR$=TIME$				!LA HORA DEL SISTEMA
HORA$=LEFT$(HOR$,2)			!SOLO LA HORA
HORAPRO$="05"
FECH$=DATE$				!LA FECHA DEL SISTEMA
ANO$=LEFT$(FECH$,2)			!EL ANO
MES$=MID$(FECH$,3,2)			!EL MES
DIA$=RIGHT$(FECH$,2)			!EL DIA

OPEN "C:/ADXALMA.DAT" DIRECT RECL 80 AS 15
DIM ALMAS$(100)
FOR K%=1 TO 100
	READ FORM "C80";#15,K%;AL$
	ALMAS$(K%)=AL$
NEXT K%
AL$=ALMAS$(1)
FECHVEN1$=STR$(VAL(LEFT$(AL$,12)))
CENCO$=MID$(FECHVEN1$,1,3)
FECHVEN$=MID$(FECHVEN1$,6,6) 
ANOVEN$=LEFT$(FECHVEN$,2)		!EL ANO DEL ADXALMA
MESVEN$=MID$(FECHVEN1$,8,2)			!EL MES DEL ADXALMA
DIAVEN$=MID$(FECHVEN1$,10,2)		!EL DIA DEL ADXALMA

CONSUL$="C:/ADX_UDT1/Z"+CENCO$+MESVEN$+DIAVEN$+".DAT"


IF ((VAL(DIAVEN$)+1)=VAL(DIA$)) THEN BEGIN 

PRINT "LA HORA DEL SISTEMA ES: ",HOR$
PRINT "LA FECHA DEL SISTEMA ES: "+FECH$+" EL ANO: "+ANO$+" MES: "+MES$+" DIA: "+DIA$ 
PRINT "LA FECHA DEL ADXALMA ES: "+FECHVEN$+" EL ANO: "+ANOVEN$+" MES: "+MESVEN$+" DIA: "+DIAVEN$ 
PRINT " "
PRINT "LA HORA ES: ",HORA$
PRINT " "
PRINT " "
PRINT "LA HORA PROGRAMADA ES: ",HORAPRO$

ENDIF ELSE BEGIN

PRINT " NO SE HA EJECUTADO EL BACKUP......"
PRINT "  "
PRINT CONSUL$
ENDIF
CONSOLE
CALL OSSHELL("C:\REINICIO.BAT")


  ERRTN:
!	NEXT n
  ERRORCOD$ = ERR
  IF ERR <> "EF" AND                \
     ERRF% = 25 THEN BEGIN  	!Si NO es END OF FILE Sess#25
     CONSOLE
     CLEARS
     PRINT
     PRINT"  "
     IF CONT%=0 THEN BEGIN
	PRINT "NO SE ENCONTRARON REGISTROS"
     ENDIF
     IF CONT%>0 THEN BEGIN
	PRINT "REGISTROS ENCONTRADOS: ",CONT% 
!	MODO LPT1=COM1
!	LPRINT FILE1$
     ENDIF    


  IF ERR = "OE" THEN BEGIN           ! Si es END OF FILE Sess#2  RORMAL EOJ..."
!        PRINT "FIN DEL PROCESO NORMAL..!"
	RESUME
	 RETURN
	STOP
	ENDIF   
ENDIF
End
